generator client {
  provider = "prisma-client-py"
}

datasource db {
  provider = "sqlite"
  url      = "file:dev.db"
}

model Candidate {
  id             Int      @id @default(autoincrement())
  handle         String   @unique
  twitterId      String?  // Twitter user ID for API calls
  name           String?
  bio            String?
  followers      Int?
  following      Int?     // Following count
  avatar         String?
  headerImage    String?
  recentTweet    String?
  pipelineStage  String?  // Pipeline stage: null, "Qualified", "Screening", "Round 1", etc.
  createdAt      DateTime @default(now())
  searches       SearchResult[]
  tweets         Tweet[]
  notifications  Notification[]
  messages       Message[]
  events         Event[]
  feedback       Feedback[]
  assessments    Assessment[]

  @@map("Candidate")
}

model SearchSession {
  id        Int      @id @default(autoincrement())
  jobTitle  String
  keywords  String   // comma-separated
  createdAt DateTime @default(now())
  results   SearchResult[]

  @@map("SearchSession")
}

model SearchResult {
  id          Int           @id @default(autoincrement())
  score       Int           // 1-100 from Grok
  reasoning   String?       // optional explanation
  candidateId Int
  sessionId   Int
  candidate   Candidate     @relation(fields: [candidateId], references: [id])
  session     SearchSession @relation(fields: [sessionId], references: [id])

  @@map("SearchResult")
}

model Tweet {
  id          Int      @id @default(autoincrement())
  tweetId     String   // Twitter's tweet ID
  content     String
  likes       Int      @default(0)
  retweets    Int      @default(0)
  replies     Int      @default(0)
  createdAt   String   // ISO timestamp from Twitter
  candidateId Int
  candidate   Candidate @relation(fields: [candidateId], references: [id])

  @@map("Tweet")
}

model Notification {
  id          Int      @id @default(autoincrement())
  candidateId Int
  message     String   // The notification message
  eventType   String   // "stage_advance", "stage_reject", etc.
  fromStage   String?  // Previous stage
  toStage     String?  // New stage
  isAIGenerated Boolean @default(false) // Whether the message was AI-generated
  sentAt      DateTime @default(now())
  candidate   Candidate @relation(fields: [candidateId], references: [id])

  @@map("Notification")
}

model Message {
  id          Int      @id @default(autoincrement())
  candidateId Int
  content     String
  senderId    String   // "recruiter-1", "hiring-manager-1", etc. or candidate ID
  senderType  String   // "recruiter", "candidate", or "internal"
  messageType String   @default("text") // "text", "meeting", "assessment", "feedback"
  metadata    String?  // JSON string for meeting/assessment/feedback details
  isRead      Boolean  @default(false)
  isInternal  Boolean  @default(false) // True for internal team discussions
  createdAt   DateTime @default(now())
  candidate   Candidate @relation(fields: [candidateId], references: [id])

  @@map("Message")
}

model Event {
  id                     Int      @id @default(autoincrement())
  candidateId            Int
  title                  String
  description            String?
  eventType              String   // "phone_screen", "technical", "final", "coffee_chat", etc.
  scheduledAt            DateTime
  duration               Int      // Duration in minutes
  meetingType            String   @default("video") // "video", "phone", "in_person"
  status                 String   @default("scheduled") // "scheduled", "completed", "cancelled"
  meetingLink            String?
  notes                  String?
  assignedInterviewerId  String?  // ID of interviewer assigned to conduct interview
  assignedInterviewerName String? // Name of assigned interviewer
  assignedInterviewerRole String? // Role of assigned interviewer
  createdAt              DateTime @default(now())
  candidate              Candidate @relation(fields: [candidateId], references: [id])

  @@map("Event")
}

model Feedback {
  id                Int      @id @default(autoincrement())
  candidateId       Int
  interviewerId     String   // "recruiter-1", "hiring-manager-1", etc.
  interviewerName   String
  interviewerRole   String
  interviewerAvatar String
  stage             String   // "Round 1", "Round 2", "Final", etc.
  rating            Int      // 1-5 overall rating
  recommendation    String   // "strong-yes", "yes", "maybe", "no", "strong-no"
  technicalSkills   Int      // 1-5
  communication     Int      // 1-5
  cultureFit        Int      // 1-5
  comments          String
  strengths         String   // JSON array of strings
  concerns          String   // JSON array of strings
  createdAt         DateTime @default(now())
  candidate         Candidate @relation(fields: [candidateId], references: [id])

  @@map("Feedback")
}

model Assessment {
  id                      Int      @id @default(autoincrement())
  candidateId             Int
  title                   String
  description             String?
  assessmentType          String   // "coding", "system-design", "take-home", etc.
  timeLimit               Int      // Time limit in minutes
  status                  String   @default("pending") // "pending", "forwarded", "reviewed"
  assignedEngineerId      String?  // "hiring-manager-1", etc.
  assignedEngineerName    String?
  assignedEngineerRole    String?
  assignedEngineerAvatar  String?
  completedAt             DateTime
  createdAt               DateTime @default(now())
  candidate               Candidate @relation(fields: [candidateId], references: [id])

  @@map("Assessment")
}