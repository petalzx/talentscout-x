generator client {
  provider = "prisma-client-py"
}

datasource db {
  provider = "sqlite"
  url      = "file:dev.db"
}

model Candidate {
  id             Int      @id @default(autoincrement())
  handle         String   @unique
  twitterId      String?  // Twitter user ID for API calls
  name           String?
  bio            String?
  followers      Int?
  following      Int?     // Following count
  avatar         String?
  headerImage    String?
  recentTweet    String?
  pipelineStage  String?  // Pipeline stage: null, "Qualified", "Screening", "Round 1", etc.
  createdAt      DateTime @default(now())
  searches       SearchResult[]
  tweets         Tweet[]
  notifications  Notification[]
  messages       Message[]
  events         Event[]

  @@map("Candidate")
}

model SearchSession {
  id        Int      @id @default(autoincrement())
  jobTitle  String
  keywords  String   // comma-separated
  createdAt DateTime @default(now())
  results   SearchResult[]

  @@map("SearchSession")
}

model SearchResult {
  id          Int           @id @default(autoincrement())
  score       Int           // 1-100 from Grok
  reasoning   String?       // optional explanation
  candidateId Int
  sessionId   Int
  candidate   Candidate     @relation(fields: [candidateId], references: [id])
  session     SearchSession @relation(fields: [sessionId], references: [id])

  @@map("SearchResult")
}

model Tweet {
  id          Int      @id @default(autoincrement())
  tweetId     String   // Twitter's tweet ID
  content     String
  likes       Int      @default(0)
  retweets    Int      @default(0)
  replies     Int      @default(0)
  createdAt   String   // ISO timestamp from Twitter
  candidateId Int
  candidate   Candidate @relation(fields: [candidateId], references: [id])

  @@map("Tweet")
}

model Notification {
  id          Int      @id @default(autoincrement())
  candidateId Int
  message     String   // The notification message
  eventType   String   // "stage_advance", "stage_reject", etc.
  fromStage   String?  // Previous stage
  toStage     String?  // New stage
  isAIGenerated Boolean @default(false) // Whether the message was AI-generated
  sentAt      DateTime @default(now())
  candidate   Candidate @relation(fields: [candidateId], references: [id])

  @@map("Notification")
}

model Message {
  id          Int      @id @default(autoincrement())
  candidateId Int
  content     String
  senderId    String   // "recruiter" or candidate ID
  senderType  String   // "recruiter" or "candidate"
  messageType String   @default("text") // "text", "meeting", "assessment"
  metadata    String?  // JSON string for meeting/assessment details
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
  candidate   Candidate @relation(fields: [candidateId], references: [id])

  @@map("Message")
}

model Event {
  id          Int      @id @default(autoincrement())
  candidateId Int
  title       String
  description String?
  eventType   String   // "phone_screen", "technical", "final", "coffee_chat", etc.
  scheduledAt DateTime
  duration    Int      // Duration in minutes
  meetingType String   @default("video") // "video", "phone", "in_person"
  status      String   @default("scheduled") // "scheduled", "completed", "cancelled"
  meetingLink String?
  notes       String?
  createdAt   DateTime @default(now())
  candidate   Candidate @relation(fields: [candidateId], references: [id])

  @@map("Event")
}